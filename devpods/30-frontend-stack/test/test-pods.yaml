apiVersion: v1
kind: Pod  
metadata:  
  name: devpods-30-test
  labels:
    name: devpods, frontend
spec: 
  volumes:
  - {name: "/tmp/.X11-unix", hostPath: {path: "/tmp/.X11-unix"}}
  - {name: ".vscode-server", hostPath: {path: "./test/.vscode-server"}}
  - {name: "test-data",      hostPath: {path: "./test/data"}}
  - {name: "test-workspace", hostPath: {path: "./test/workspace"}}
  containers:
  - name: frontend
    image: bizobj-container.net/pods/frontend-stack:latest
    stdin: true
    tty: true
    volumeMounts:
    - {mountPath: "/tmp/.X11-unix",       name: "/tmp/.X11-unix"}
    - {mountPath: "/root/.vscode-server", name: ".vscode-server" }
    - {mountPath: "/data",                name: "test-data" }
    - {mountPath: "/root/workspace",      name: "test-workspace" }
    env:
    - {name: "DISPLAY", value: "unix$DISPLAY"}
    command: 
    - 'bash'
    - '-ic'
    - |
      sleep 2s
      export
      set -x
      cat /etc/os-release
      node -v
      npm -v
      yarn -v
      pnpm -v
      python3 --version
      pip3 --version
      pipx --version
      uv --version

      echo "=== Testing Python persistence configuration ==="
      echo "Environment variables:"
      env | grep -E '^(PIPX_|UV_|PYTHONUSERBASE)=' || echo "Some environment variables not set"
      echo ""
      echo "Directory structure in /data/python/:"
      ls -la /data/python/
      echo ""
      echo "Pip configuration:"
      pip config list
      echo ""
      echo "Pipx environment:"
      pipx environment
      echo ""
      echo "Checking /data/python/pipx/bin for executables:"
      ls -la /data/python/pipx/bin/ || echo "Directory not found or empty"
      echo ""

      echo "=== Installing test packages ==="
      echo "Installing pipx packages (black, ruff)..."
      pipx install black
      pipx install ruff
      echo ""
      echo "Installing pip user package (requests)..."
      pip install --user requests
      echo ""
      echo "=== Verifying installation locations ==="
      echo "Pipx symlinks in /data/python/pipx/bin/:"
      ls -la /data/python/pipx/bin/
      echo ""
      echo "Pipx venvs in /data/python/pipx/venvs/:"
      ls -la /data/python/pipx/venvs/
      echo ""
      echo "Pip user packages in /data/python/global/lib/python*/site-packages/:"
      find /data/python/global/lib -name "requests" -type d 2>/dev/null || echo "requests not found"
      echo ""

      echo "=== Testing installed tools ==="
      black --version || echo "black command not found in PATH"
      ruff --version || echo "ruff command not found in PATH"
      python3 -c "import requests; print(f'requests version: {requests.__version__}')" || echo "requests module not found"
      echo ""
      echo "=== Persistence test complete ==="
      
      bash -il
